const fetch = require('node-fetch');

module.exports = async function(params) {
    if (!params.state && !params.sort) {
        let fiftystates = await fetch(`https://corona.lmao.ninja/v2/states`).then(r=>r.json());
        if (!fiftystates || fiftystates.length == 0) return { error: "API may be down, please try again later."}
        else return fiftystates;
    } else if (!params.state && params.sort) {
        let filteredStates = await fetch(`https://corona.lmao.ninja/v2/states`).then(r=>r.json());
        if (!filteredStates || filteredStates.length == 0) return { error: "API may be down, please try again later."}
        filteredStates = filteredStates.sort((a, b) => a[params.sort] + b[params.sort])
        return filteredStates;
    } else if (params.state) {
        let filteredState = await fetch(`https://corona.lmao.ninja/v2/states`).then(r=>r.json());
        if (!filteredState || filteredState.length == 0) return { error: "API may be down, please try again later."}
        filteredState = await filteredState.filter(x=>x.state.toLowerCase() === params.state.toLowerCase());
        return filteredState[0];
    }
}