const fetch = require('node-fetch');

module.exports = async function(params) {
    if (!params.country && !params.sort) {
        let data = await fetch(`https://corona.lmao.ninja/v2/historical/`).then(r=>r.json());
        if (!data || data.length == 0) return { error: "API may be down, please try again later."}
        else return data;
    } else if (params.country.toLowerCase() === 'all') {
        let data = await fetch(`https://corona.lmao.ninja/v2/historical/all`).then(r=>r.json());
        if (!data || data.length == 0) return { error: "API may be down, please try again later."}
        else return data;
    } else if (params.country || params.province) {
        try { return await fetch(`https://corona.lmao.ninja/v2/historical/${params.country}/${params.province}`).then(r=>r.json()); } catch (e) { return { error: "API may be down, please try again later."}; };
    } else if (params.country) {
        try { return await fetch(`https://corona.lmao.ninja/v2/historical/${params.country}`).then(r=>r.json()); } catch (e) { return { error: "API may be down, please try again later."}; };
    }
}